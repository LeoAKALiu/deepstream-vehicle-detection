# 现场测试检查清单

**测试日期**: ___________  
**测试地点**: ___________  
**测试人员**: ___________

---

## 📋 一、硬件准备

### 1.1 核心设备
- [ ] **Jetson设备**
  - [ ] 电源适配器（确保供电充足）
  - [ ] 已安装所有依赖库
  - [ ] 系统时间正确
  - [ ] 存储空间充足（至少10GB可用）

- [ ] **Orbbec Gemini 335L深度相机**
  - [ ] USB连接线
  - [ ] 相机已正确连接并识别
  - [ ] 相机权限已配置（`/dev/video*`）
  - [ ] 测试脚本可正常获取RGB和深度帧

- [ ] **Cassia蓝牙路由器**
  - [ ] 电源适配器
  - [ ] 网线（连接PoE路由器）
  - [ ] 已配置IP地址：`192.168.1.2`
  - [ ] 可通过SSE接口访问（`http://192.168.1.2/gap/nodes?event=1`）

- [ ] **PoE路由器**
  - [ ] 已为Jetson和Cassia分配IP
  - [ ] Jetson有线网口：`192.168.1.3`
  - [ ] Cassia路由器：`192.168.1.2`
  - [ ] 网络连通性测试通过

- [ ] **BLE信标标签**
  - [ ] 至少1个已激活的信标
  - [ ] MAC地址已记录：`45:C6:6A:F2:46:19`
  - [ ] 信标电量充足
  - [ ] 信标已绑定到车辆类型（excavator）

### 1.2 辅助设备
- [ ] 测试车辆图片（iPad/平板）
- [ ] 备用网线
- [ ] 备用电源线
- [ ] 显示器/HDMI线（用于现场调试）
- [ ] 键盘鼠标（备用）

---

## 🔧 二、软件配置

### 2.1 网络配置（⚠️ 重要）
- [ ] **Jetson有线网络**
  - [ ] 静态IP已配置：`192.168.1.3/24`
  - [ ] 路由规则已设置（访问`192.168.1.2`走有线）
  - [ ] 测试：`ping -c 4 192.168.1.2` 成功
  - [ ] Wi-Fi保持启用（用于远程访问）

- [ ] **Cassia路由器**
  - [ ] IP地址：`192.168.1.2`
  - [ ] 可通过浏览器访问管理界面
  - [ ] BLE扫描功能正常

### 2.2 配置文件
- [ ] **信标白名单** (`beacon_whitelist.yaml`)
  - [ ] 文件路径正确：`deepstream-vehicle-detection/beacon_whitelist.yaml`
  - [ ] 已添加现场信标MAC地址
  - [ ] 车辆类型匹配正确（excavator/truck等）
  - [ ] `active: true` 已设置
  - [ ] `camera_id` 配置正确（默认：`camera_01`）

- [ ] **模型文件**
  - [ ] 自定义模型存在：`models/custom_yolo.engine`
  - [ ] 模型文件大小正常（约54MB）
  - [ ] 模型类别定义正确（10类：excavator, bulldozer, truck, car等）

### 2.3 代码配置
- [ ] **Cassia IP地址**
  - [ ] `test_system_realtime.py` 默认IP：`192.168.1.27` → **需改为 `192.168.1.2`**
  - [ ] `test_realtime_system.sh` 中的IP地址已更新
  - [ ] `test_ble_beacon.sh` 中的IP地址已更新
  - [ ] 其他脚本中的IP地址已统一

- [ ] **Python依赖**
  - [ ] `pyorbbecsdk` 已安装
  - [ ] `hyperlpr3` 已安装
  - [ ] `tensorrt` 已安装
  - [ ] `pycuda` 已安装
  - [ ] `opencv-python` 已安装
  - [ ] `numpy` 已安装
  - [ ] `PIL` 已安装
  - [ ] `yaml` 已安装
  - [ ] `aiohttp` 和 `aiohttp-sse-client` 已安装

---

## 🧪 三、功能测试

### 3.1 单模块测试
- [ ] **Orbbec相机测试**
  ```bash
  cd /home/liubo/Download/deepstream-vehicle-detection
  python3 python_apps/test_orbbec.py
  ```
  - [ ] RGB图像正常显示
  - [ ] 深度图像正常显示
  - [ ] 深度值测量正常（0.5-10米范围）

- [ ] **Cassia BLE测试**
  ```bash
  ./测试BLE信标.sh
  ```
  - [ ] 能扫描到信标
  - [ ] RSSI值正常（-50到-90之间）
  - [ ] MAC地址匹配白名单

- [ ] **YOLO模型测试**
  ```bash
  python3 python_apps/tensorrt_yolo_inference.py <测试视频>
  ```
  - [ ] 能检测到工程车辆（excavator/truck等）
  - [ ] 能检测到社会车辆（car）
  - [ ] 检测框位置准确
  - [ ] FPS > 10

- [ ] **信标过滤器测试**
  ```bash
  ./测试信标过滤器.sh
  ```
  - [ ] 白名单过滤正常
  - [ ] RSSI过滤正常
  - [ ] 距离匹配正常
  - [ ] 置信度评分正常

### 3.2 集成测试
- [ ] **完整系统测试**
  ```bash
  ./test_realtime_system.sh
  ```
  - [ ] 系统启动无错误
  - [ ] 相机画面正常显示
  - [ ] 检测框正常显示
  - [ ] 信标扫描正常
  - [ ] 深度测量正常
  - [ ] 车牌识别正常（如有社会车辆）

### 3.3 场景测试
- [ ] **场景1：已备案工程车辆（带BLE标签）**
  - [ ] 展示工程车辆图片（excavator）
  - [ ] 在图片上放置BLE标签
  - [ ] 系统识别为"已备案车辆"
  - [ ] 无报警输出

- [ ] **场景2：未备案工程车辆（无BLE标签）**
  - [ ] 展示工程车辆图片（excavator/truck等）
  - [ ] 不放置BLE标签
  - [ ] 系统识别为"未备案工程车辆"
  - [ ] 报警输出正常

- [ ] **场景3：未备案工程车辆（类型不匹配）**
  - [ ] 展示truck图片
  - [ ] 放置excavator的BLE标签
  - [ ] 系统识别为"未备案工程车辆！（类型不匹配）"
  - [ ] 报警输出正常

- [ ] **场景4：社会车辆**
  - [ ] 展示社会车辆图片（car）
  - [ ] 系统识别为"社会车辆"
  - [ ] 车牌识别正常（如有车牌）
  - [ ] 输出车牌号码

---

## 🐛 四、问题排查准备

### 4.1 常见问题检查
- [ ] **相机无法识别**
  - [ ] 检查USB连接
  - [ ] 检查权限：`ls -l /dev/video*`
  - [ ] 运行：`./配置Orbbec权限.sh`

- [ ] **Cassia无法连接**
  - [ ] 检查网络：`ping 192.168.1.2`
  - [ ] 检查SSE接口：`curl -N 'http://192.168.1.2/gap/nodes?event=1'`
  - [ ] 检查防火墙设置

- [ ] **模型加载失败**
  - [ ] 检查模型文件路径
  - [ ] 检查TensorRT版本兼容性
  - [ ] 检查CUDA环境

- [ ] **信标无法匹配**
  - [ ] 检查白名单配置
  - [ ] 检查RSSI阈值设置
  - [ ] 检查信标距离（应在5-30米内）

### 4.2 调试工具
- [ ] **日志输出**
  - [ ] 系统日志保存路径：`/tmp/vehicle_detection.log`
  - [ ] 错误日志已启用

- [ ] **调试脚本**
  - [ ] `测试BLE信标.sh` - 独立测试BLE
  - [ ] `测试信标过滤器.sh` - 测试过滤器
  - [ ] `调试检测.sh` - 可视化检测结果

---

## 📝 五、现场部署检查

### 5.1 环境准备
- [ ] 相机安装位置固定
- [ ] 相机视野覆盖目标区域
- [ ] 网络线缆固定（避免松动）
- [ ] 电源稳定（避免断电）

### 5.2 启动流程
1. [ ] 连接所有硬件设备
2. [ ] 启动Cassia路由器（等待1分钟）
3. [ ] 启动Jetson设备
4. [ ] 检查网络连接
5. [ ] 运行测试脚本验证
6. [ ] 启动完整系统

### 5.3 运行监控
- [ ] FPS监控（应 > 10 FPS）
- [ ] 内存使用监控（避免OOM）
- [ ] GPU使用监控（TensorRT推理）
- [ ] 网络连接监控（Cassia连接状态）

---

## ✅ 六、测试完成确认

### 6.1 功能验证
- [ ] 所有场景测试通过
- [ ] 报警输出正确
- [ ] 车牌识别准确
- [ ] 系统稳定运行 > 30分钟

### 6.2 性能验证
- [ ] 平均FPS > 10
- [ ] 检测延迟 < 200ms
- [ ] 内存占用 < 4GB
- [ ] GPU占用正常

### 6.3 文档记录
- [ ] 测试结果已记录
- [ ] 问题已记录
- [ ] 配置变更已记录
- [ ] 现场照片已拍摄

---

## 🚨 紧急联系信息

- **技术支持**: _______________
- **现场负责人**: _______________
- **备用方案**: _______________

---

## 📌 注意事项

1. **网络配置优先级**：确保Cassia通信走有线网络（`192.168.1.2`），Wi-Fi仅用于远程访问
2. **信标距离**：BLE信标应在相机视野5-30米范围内，超出范围可能无法匹配
3. **模型类别**：确保检测的车辆类型在模型的10个类别中
4. **深度测量**：深度相机需要物体在0.5-10米范围内才能准确测量
5. **系统重启**：如遇问题，优先重启Cassia路由器，再重启Jetson

---

## 🔄 待完成工作（现场测试前）

### 高优先级（必须完成）
- [ ] **更新Cassia IP地址**：将所有脚本中的 `192.168.1.27` 改为 `192.168.1.2`
- [ ] **配置静态IP和路由**：确保Jetson有线网络稳定
- [ ] **验证网络连通性**：`ping 192.168.1.2` 必须成功
- [ ] **更新信标白名单**：确认现场信标的MAC地址和车辆类型

### 中优先级（建议完成）
- [ ] **完整功能测试**：在实验室完成所有场景测试
- [ ] **性能压力测试**：连续运行30分钟以上
- [ ] **备用方案准备**：准备离线测试方案（如Cassia故障）

### 低优先级（可选）
- [ ] **日志系统优化**：添加更详细的日志记录
- [ ] **配置文件备份**：备份所有配置文件
- [ ] **文档更新**：更新现场部署文档

---

**最后更新**: 2024年11月4日  
**版本**: v1.0


