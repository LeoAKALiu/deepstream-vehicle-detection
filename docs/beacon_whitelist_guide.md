# ğŸ“‹ ä¿¡æ ‡ç™½åå•é…ç½®æŒ‡å—

## ç›®å½•
- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
- [å¤šçº§è¿‡æ»¤æœºåˆ¶](#å¤šçº§è¿‡æ»¤æœºåˆ¶)
- [é…ç½®ç¤ºä¾‹](#é…ç½®ç¤ºä¾‹)
- [å¾®ä¿¡å°ç¨‹åºå¯¹æ¥](#å¾®ä¿¡å°ç¨‹åºå¯¹æ¥)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

### é—®é¢˜èƒŒæ™¯

Cassiaè“ç‰™è·¯ç”±å™¨å¯èƒ½ä¼šæ‰«æåˆ°é™„è¿‘100-200ç±³å†…çš„å¤§é‡BLEä¿¡æ ‡ï¼ŒåŒ…æ‹¬ï¼š
- æœªä¸å·¥ç¨‹è½¦è¾†ç»‘å®šçš„ä¿¡æ ‡
- å…¶ä»–åŒºåŸŸçš„å·¥ç¨‹è½¦è¾†ä¿¡æ ‡
- å„ç±»å…¶ä»–BLEè®¾å¤‡

### è§£å†³æ–¹æ¡ˆ

é‡‡ç”¨**ç™½åå• + å¤šçº§è¿‡æ»¤**æœºåˆ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cassiaæ‰«æèŒƒå›´ï¼ˆçƒå½¢ï¼ŒåŠå¾„100-200mï¼‰         â”‚
â”‚                                             â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±                   â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±ğŸ“±  [æ‘„åƒå¤´åŒºåŸŸ]  ğŸ“±ğŸ“±ğŸ“±                â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±    ğŸ“¹           ğŸ“±ğŸ“±ğŸ“±                â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±   /   \         ğŸ“±ğŸ“±ğŸ“±                â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±  /  ğŸšœ  \       ğŸ“±ğŸ“±ğŸ“±                â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“± /   ğŸšœ   \      ğŸ“±ğŸ“±ğŸ“±                â”‚
â”‚   ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±ğŸ“±                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
      ã€å¤šçº§è¿‡æ»¤ã€‘
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ ç™½åå•è¿‡æ»¤ â†’ åªå¤„ç†å·²æ³¨å†Œä¿¡æ ‡             â”‚
â”‚ 2ï¸âƒ£ RSSIè¿‡æ»¤ â†’ ä¿¡å·å¼ºåº¦ > -70dBm              â”‚
â”‚ 3ï¸âƒ£ è·ç¦»åŒ¹é… â†’ |æ·±åº¦ - RSSIè·ç¦»| < 3m         â”‚
â”‚ 4ï¸âƒ£ æ—¶é—´çª—å£ â†’ æŒç»­å‡ºç° > 3ç§’                 â”‚
â”‚ 5ï¸âƒ£ ç½®ä¿¡åº¦è¯„åˆ† â†’ ç»¼åˆè¯„åˆ† > 0.6              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         æœ€ä½³åŒ¹é… âœ…
```

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### æ–‡ä»¶ä½ç½®
```
deepstream-vehicle-detection/
  â””â”€â”€ beacon_whitelist.yaml
```

### é…ç½®ç»“æ„

```yaml
global_config:          # å…¨å±€é…ç½®
  rssi_thresholds:      # RSSIé˜ˆå€¼
  distance_match:       # è·ç¦»åŒ¹é…å‚æ•°
  time_window:          # æ—¶é—´çª—å£å‚æ•°
  confidence_threshold: # ç½®ä¿¡åº¦é˜ˆå€¼

cameras:                # æ‘„åƒå¤´é…ç½®
  camera_01:            # æ‘„åƒå¤´ID
    name: "..."         # åç§°
    location:           # ä½ç½®
    coverage_radius:    # è¦†ç›–åŠå¾„
    rssi_threshold:     # RSSIé˜ˆå€¼
    beacons:            # ç™½åå•
      - mac: "..."      # MACåœ°å€
        vehicle_type:   # è½¦è¾†ç±»å‹
        plate_number:   # è½¦ç‰Œå·
        company:        # æ‰€å±å…¬å¸
        notes:          # å¤‡æ³¨
        active: true    # æ¿€æ´»çŠ¶æ€
```

### å…¨å±€é…ç½®å‚æ•°è¯¦è§£

#### 1. RSSIé˜ˆå€¼é…ç½®

```yaml
rssi_thresholds:
  very_close: -50   # < 5ç±³ï¼ˆéå¸¸è¿‘ï¼‰
  close: -60        # 5-10ç±³ï¼ˆè¿‘ï¼‰
  medium: -70       # 10-20ç±³ï¼ˆä¸­ç­‰ï¼‰â­ æ¨è
  far: -80          # 20-50ç±³ï¼ˆè¿œï¼‰
  default: -70      # é»˜è®¤é˜ˆå€¼
```

**è°ƒæ•´å»ºè®®ï¼š**
- å¯†é›†åœºæ™¯ï¼ˆå¤šè½¦è¾†ï¼‰ï¼š-60 dBmï¼ˆæ›´ä¸¥æ ¼ï¼‰
- ç©ºæ—·åœºæ™¯ï¼ˆå°‘è½¦è¾†ï¼‰ï¼š-75 dBmï¼ˆæ›´å®½æ¾ï¼‰

#### 2. è·ç¦»åŒ¹é…é…ç½®

```yaml
distance_match:
  tolerance: 3.0         # å®¹å¿åº¦ï¼ˆç±³ï¼‰
  depth_priority: true   # ä¼˜å…ˆä½¿ç”¨æ·±åº¦ç›¸æœº
```

**å·¥ä½œåŸç†ï¼š**
```
æ·±åº¦ç›¸æœº: 8.5m
ä¿¡æ ‡1 RSSIè·ç¦»: 8.2m â†’ å·®0.3m âœ… åŒ¹é…
ä¿¡æ ‡2 RSSIè·ç¦»: 15.0m â†’ å·®6.5m âŒ è¿‡æ»¤
```

#### 3. æ—¶é—´çª—å£é…ç½®

```yaml
time_window:
  min_duration: 3.0      # æœ€å°‘æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
  history_size: 100      # å†å²è®°å½•æ•°é‡
```

**ä½œç”¨ï¼š**
- é¿å…ç¬æ—¶è¯¯æ£€
- ç¡®ä¿ä¿¡æ ‡ç¡®å®åœ¨è§†é‡å†…
- æé«˜åŒ¹é…ç¨³å®šæ€§

#### 4. ç½®ä¿¡åº¦é˜ˆå€¼

```yaml
confidence_threshold: 0.6  # æœ€ä½åŒ¹é…ç½®ä¿¡åº¦ (0-1)
```

**ç½®ä¿¡åº¦è®¡ç®—ï¼š**
```python
ç½®ä¿¡åº¦ = RSSIè¯„åˆ† (0-0.3)
       + è·ç¦»åŒ¹é…è¯„åˆ† (0-0.4)
       + æ—¶é—´æŒç»­è¯„åˆ† (0-0.3)
```

---

## å¤šçº§è¿‡æ»¤æœºåˆ¶

### è¿‡æ»¤æµç¨‹å›¾

```
Cassiaæ‰«æç»“æœ (100+ ä¿¡æ ‡)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1çº§ï¼šç™½åå•è¿‡æ»¤           â”‚
â”‚ - åªä¿ç•™å·²æ³¨å†Œä¿¡æ ‡          â”‚
â”‚ - è¿‡æ»¤å…¶ä»–è®¾å¤‡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (10 ä¿¡æ ‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2çº§ï¼šRSSIè¿‡æ»¤             â”‚
â”‚ - è¿‡æ»¤ä¿¡å·å¼±çš„ï¼ˆè¿œè·ç¦»ï¼‰    â”‚
â”‚ - é˜ˆå€¼ï¼š> -70 dBm           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (5 ä¿¡æ ‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3çº§ï¼šè·ç¦»åŒ¹é…             â”‚
â”‚ - å¯¹æ¯”æ·±åº¦ç›¸æœº vs RSSI     â”‚
â”‚ - å®¹å·®ï¼šÂ± 3 ç±³              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (2 ä¿¡æ ‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬4çº§ï¼šæ—¶é—´çª—å£             â”‚
â”‚ - åªä¿ç•™æŒç»­å‡ºç°çš„          â”‚
â”‚ - æœ€å°‘ï¼š3 ç§’                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (1-2 ä¿¡æ ‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬5çº§ï¼šç½®ä¿¡åº¦è¯„åˆ†           â”‚
â”‚ - ç»¼åˆè¯„åˆ†æ’åº              â”‚
â”‚ - é˜ˆå€¼ï¼š> 0.6               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    æœ€ä½³åŒ¹é… âœ…
```

### ç½®ä¿¡åº¦è¯„åˆ†è¯¦è§£

| è¯„åˆ†é¡¹ | æƒé‡ | è¯´æ˜ |
|--------|------|------|
| **RSSIè¯„åˆ†** | 0-0.3 | ä¿¡å·å¼ºåº¦è¶Šå¼ºï¼Œè¯„åˆ†è¶Šé«˜ |
| **è·ç¦»è¯„åˆ†** | 0-0.4 | è·ç¦»å·®è¶Šå°ï¼Œè¯„åˆ†è¶Šé«˜ï¼ˆæƒé‡æœ€å¤§ï¼‰ |
| **æ—¶é—´è¯„åˆ†** | 0-0.3 | æŒç»­æ—¶é—´è¶Šé•¿ï¼Œè¯„åˆ†è¶Šé«˜ |

#### RSSIè¯„åˆ†è¡¨

| RSSIèŒƒå›´ | è·ç¦» | è¯„åˆ† |
|----------|------|------|
| > -50 dBm | < 5m | 0.30 |
| > -60 dBm | 5-10m | 0.25 |
| > -70 dBm | 10-20m | 0.20 |
| > -80 dBm | 20-50m | 0.15 |
| â‰¤ -80 dBm | > 50m | 0.10 |

#### è·ç¦»è¯„åˆ†è¡¨

| è·ç¦»å·® | è¯„åˆ† |
|--------|------|
| < 1.0 m | 0.40 |
| < 2.0 m | 0.30 |
| < 3.0 m | 0.20 |
| â‰¥ 3.0 m | 0.10 |

#### æ—¶é—´è¯„åˆ†è¡¨

| æŒç»­æ—¶é—´ | è¯„åˆ† |
|----------|------|
| â‰¥ 10 ç§’ | 0.30 |
| â‰¥ 5 ç§’ | 0.25 |
| â‰¥ 3 ç§’ | 0.20 |
| < 3 ç§’ | 0.10 |

### è¯„åˆ†ç¤ºä¾‹

**åœºæ™¯1ï¼šç†æƒ³åŒ¹é…**
```
RSSI: -55 dBm (å¾ˆè¿‘) â†’ 0.25
è·ç¦»å·®: 0.8m â†’ 0.40
æŒç»­æ—¶é—´: 12ç§’ â†’ 0.30
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»åˆ†: 0.95 âœ… é«˜ç½®ä¿¡åº¦
```

**åœºæ™¯2ï¼šè¾¹ç¼˜åŒ¹é…**
```
RSSI: -68 dBm (ä¸­ç­‰) â†’ 0.20
è·ç¦»å·®: 2.5m â†’ 0.20
æŒç»­æ—¶é—´: 3.5ç§’ â†’ 0.20
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»åˆ†: 0.60 âš ï¸ åˆšå¥½é€šè¿‡
```

**åœºæ™¯3ï¼šæ— æ•ˆåŒ¹é…**
```
RSSI: -75 dBm (è¾ƒå¼±) â†’ 0.15
è·ç¦»å·®: 5.0m â†’ 0.10
æŒç»­æ—¶é—´: 1.5ç§’ â†’ 0.10
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»åˆ†: 0.35 âŒ è¢«è¿‡æ»¤
```

---

## é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå•æ‘„åƒå¤´é…ç½®

```yaml
global_config:
  rssi_thresholds:
    default: -70
  distance_match:
    tolerance: 3.0
    depth_priority: true
  time_window:
    min_duration: 3.0
    history_size: 100
  confidence_threshold: 0.6

cameras:
  camera_01:
    name: "ä¸»å…¥å£ç›‘æ§"
    location:
      lat: 22.547
      lng: 114.085
    coverage_radius: 30
    rssi_threshold: -70
    
    beacons:
      - mac: "68:E4:78:12:34:56"
        vehicle_type: "excavator"
        plate_number: "ç²¤B12345"
        company: "XXå»ºè®¾é›†å›¢"
        notes: "1å·æŒ–æ˜æœº"
        active: true
      
      - mac: "68:E4:78:12:34:57"
        vehicle_type: "loader"
        plate_number: "ç²¤B23456"
        company: "XXå»ºè®¾é›†å›¢"
        notes: "2å·è£…è½½æœº"
        active: true
```

### ç¤ºä¾‹2ï¼šå¤šæ‘„åƒå¤´é…ç½®

```yaml
cameras:
  camera_01:
    name: "ä¸»å…¥å£"
    coverage_radius: 30
    rssi_threshold: -70
    beacons:
      - mac: "68:E4:78:12:34:56"
        vehicle_type: "excavator"
        plate_number: "ç²¤B12345"
        active: true
  
  camera_02:
    name: "ä¸œåŒºä½œä¸šé¢"
    coverage_radius: 50
    rssi_threshold: -75  # æ›´å¤§çš„è¦†ç›–èŒƒå›´ï¼Œç¨å¾®å®½æ¾
    beacons:
      - mac: "68:E4:78:12:34:58"
        vehicle_type: "dump-truck"
        plate_number: "ç²¤B34567"
        active: true
      
      - mac: "68:E4:78:12:34:59"
        vehicle_type: "crane"
        plate_number: "ç²¤B45678"
        active: false  # å·²åœç”¨
```

### ç¤ºä¾‹3ï¼šå¯†é›†åœºæ™¯é…ç½®

```yaml
global_config:
  rssi_thresholds:
    default: -60  # æ›´ä¸¥æ ¼ï¼Œåªä¿ç•™å¾ˆè¿‘çš„ä¿¡æ ‡
  distance_match:
    tolerance: 2.0  # æ›´å°çš„å®¹å·®
  time_window:
    min_duration: 5.0  # æ›´é•¿çš„æŒç»­æ—¶é—´
  confidence_threshold: 0.7  # æ›´é«˜çš„ç½®ä¿¡åº¦è¦æ±‚
```

---

## å¾®ä¿¡å°ç¨‹åºå¯¹æ¥

### æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾®ä¿¡å°ç¨‹åº    â”‚
â”‚              â”‚
â”‚ 1. æ‰«æäºŒç»´ç  â”‚ â†’ è·å–MACåœ°å€
â”‚ 2. å¡«å†™ä¿¡æ¯   â”‚ â†’ è½¦è¾†ç±»å‹ã€è½¦ç‰Œå·ç­‰
â”‚ 3. é€‰æ‹©åŒºåŸŸ   â”‚ â†’ camera_01/camera_02
â”‚ 4. æäº¤ç»‘å®š   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åå°APIæœåŠ¡  â”‚
â”‚              â”‚
â”‚ /api/beacon  â”‚
â”‚   /bind      â”‚ â†’ æ›´æ–° beacon_whitelist.yaml
â”‚   /list      â”‚ â†’ æŸ¥è¯¢ç™½åå•
â”‚   /activate  â”‚ â†’ æ¿€æ´»/åœç”¨ä¿¡æ ‡
â”‚   /delete    â”‚ â†’ åˆ é™¤ä¿¡æ ‡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Jetsonç³»ç»Ÿ   â”‚
â”‚              â”‚
â”‚ å®šæœŸé‡è½½é…ç½®  â”‚ â†’ æ¯60ç§’é‡è½½ä¸€æ¬¡
â”‚ æˆ–æ¥æ”¶ä¿¡å·    â”‚ â†’ æ”¶åˆ°é€šçŸ¥ç«‹å³é‡è½½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APIæ¥å£è®¾è®¡

#### 1. ç»‘å®šä¿¡æ ‡

**è¯·æ±‚ï¼š**
```http
POST /api/beacon/bind
Content-Type: application/json

{
  "mac": "68:E4:78:12:34:56",
  "camera_id": "camera_01",
  "vehicle_type": "excavator",
  "plate_number": "ç²¤B12345",
  "company": "XXå»ºè®¾é›†å›¢",
  "notes": "1å·æŒ–æ˜æœº"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "ä¿¡æ ‡ç»‘å®šæˆåŠŸ",
  "beacon": {
    "mac": "68:E4:78:12:34:56",
    "vehicle_type": "excavator",
    "camera_id": "camera_01",
    "active": true
  }
}
```

#### 2. æŸ¥è¯¢ç™½åå•

**è¯·æ±‚ï¼š**
```http
GET /api/beacon/list?camera_id=camera_01
```

**å“åº”ï¼š**
```json
{
  "camera_id": "camera_01",
  "camera_name": "ä¸»å…¥å£ç›‘æ§",
  "beacons": [
    {
      "mac": "68:E4:78:12:34:56",
      "vehicle_type": "excavator",
      "plate_number": "ç²¤B12345",
      "company": "XXå»ºè®¾é›†å›¢",
      "active": true
    }
  ]
}
```

#### 3. æ¿€æ´»/åœç”¨ä¿¡æ ‡

**è¯·æ±‚ï¼š**
```http
POST /api/beacon/activate
Content-Type: application/json

{
  "mac": "68:E4:78:12:34:56",
  "active": false
}
```

#### 4. åˆ é™¤ä¿¡æ ‡

**è¯·æ±‚ï¼š**
```http
DELETE /api/beacon/delete
Content-Type: application/json

{
  "mac": "68:E4:78:12:34:56"
}
```

### å¾®ä¿¡å°ç¨‹åºç¤ºä¾‹ä»£ç 

```javascript
// æ‰«æä¿¡æ ‡äºŒç»´ç 
function scanBeacon() {
  wx.scanCode({
    onlyFromCamera: true,
    scanType: ['qrCode'],
    success: (res) => {
      const mac = res.result;  // å‡è®¾äºŒç»´ç å†…å®¹ä¸ºMACåœ°å€
      showBindForm(mac);
    }
  });
}

// æ˜¾ç¤ºç»‘å®šè¡¨å•
function showBindForm(mac) {
  wx.navigateTo({
    url: `/pages/bind/bind?mac=${mac}`
  });
}

// æäº¤ç»‘å®š
function bindBeacon(data) {
  wx.request({
    url: 'https://your-api.com/api/beacon/bind',
    method: 'POST',
    data: {
      mac: data.mac,
      camera_id: data.camera_id,
      vehicle_type: data.vehicle_type,
      plate_number: data.plate_number,
      company: data.company,
      notes: data.notes
    },
    success: (res) => {
      if (res.data.success) {
        wx.showToast({
          title: 'ç»‘å®šæˆåŠŸ',
          icon: 'success'
        });
      } else {
        wx.showToast({
          title: 'ç»‘å®šå¤±è´¥',
          icon: 'error'
        });
      }
    }
  });
}

// æŸ¥çœ‹å·²ç»‘å®šä¿¡æ ‡
function listBeacons(cameraId) {
  wx.request({
    url: `https://your-api.com/api/beacon/list?camera_id=${cameraId}`,
    method: 'GET',
    success: (res) => {
      // æ˜¾ç¤ºä¿¡æ ‡åˆ—è¡¨
      this.setData({
        beacons: res.data.beacons
      });
    }
  });
}
```

### é…ç½®çƒ­é‡è½½

åœ¨ `test_system_realtime.py` ä¸­æ·»åŠ é…ç½®é‡è½½åŠŸèƒ½ï¼š

```python
import threading
import time

class RealtimeVehicleDetection:
    def __init__(self, ...):
        # ... ç°æœ‰ä»£ç  ...
        
        # å¯åŠ¨é…ç½®ç›‘æ§çº¿ç¨‹
        self.config_reload_thread = threading.Thread(
            target=self._config_reload_loop,
            daemon=True
        )
        self.config_reload_thread.start()
    
    def _config_reload_loop(self):
        """å®šæœŸé‡è½½é…ç½®"""
        while True:
            time.sleep(60)  # æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡
            try:
                if self.beacon_filter:
                    config_path = os.path.join(
                        os.path.dirname(__file__), 
                        'beacon_whitelist.yaml'
                    )
                    self.beacon_filter.reload_config(config_path)
            except Exception as e:
                print(f"é…ç½®é‡è½½å¤±è´¥: {e}")
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®å®šåˆé€‚çš„RSSIé˜ˆå€¼ï¼Ÿ

**A:** è¿›è¡Œç°åœºæµ‹è¯•ï¼š

```bash
# è¿è¡Œç‹¬ç«‹æµ‹è¯•
bash æµ‹è¯•BLEä¿¡æ ‡.sh

# åœ¨ä¸åŒè·ç¦»æ”¾ç½®ä¿¡æ ‡ï¼Œè®°å½•RSSIå€¼ï¼š
è·ç¦»    RSSI
5m   â†’ -55 dBm
10m  â†’ -65 dBm
20m  â†’ -75 dBm
30m  â†’ -85 dBm

# æ ¹æ®æ‘„åƒå¤´è¦†ç›–èŒƒå›´è®¾ç½®é˜ˆå€¼
è¦†ç›–30m â†’ ä½¿ç”¨ -75 dBm
è¦†ç›–20m â†’ ä½¿ç”¨ -70 dBm
è¦†ç›–10m â†’ ä½¿ç”¨ -60 dBm
```

### Q2: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ£€æµ‹ä¸åˆ°ä¿¡æ ‡ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**

1. **ç™½åå•ä¸­ä¸å­˜åœ¨** â†’ æ£€æŸ¥ `beacon_whitelist.yaml`
2. **RSSIå¤ªå¼±** â†’ è°ƒæ•´ `rssi_threshold`
3. **æŒç»­æ—¶é—´ä¸è¶³** â†’ é™ä½ `min_duration`
4. **ç½®ä¿¡åº¦ä¸è¶³** â†’ é™ä½ `confidence_threshold`

**è°ƒè¯•æ–¹æ³•ï¼š**

```bash
# æŸ¥çœ‹è¯¦ç»†è¿‡æ»¤è¿‡ç¨‹
cd /home/liubo/Download/deepstream-vehicle-detection
python3 test_system_realtime.py --camera-id camera_01

# è§‚å¯Ÿè¾“å‡ºï¼š
# ğŸ” [è¿‡æ»¤å™¨] ç™½åå•è¿‡æ»¤: 150 â†’ 3 ä¸ªä¿¡æ ‡
# ğŸ“¡ [è¿‡æ»¤å™¨] RSSIè¿‡æ»¤: 3 â†’ 2 ä¸ªä¿¡æ ‡
# ğŸ“ [è¿‡æ»¤å™¨] è·ç¦»åŒ¹é…: 2 â†’ 1 ä¸ªä¿¡æ ‡
# â±ï¸  [è¿‡æ»¤å™¨] æ—¶é—´çª—å£: 1 â†’ 0 ä¸ªä¿¡æ ‡  â† é—®é¢˜åœ¨è¿™é‡Œï¼
```

### Q3: å¦‚ä½•å¤„ç†å¤šä¸ªä¿¡æ ‡éƒ½ç¬¦åˆæ¡ä»¶ï¼Ÿ

**A:** ç³»ç»Ÿä¼šé€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„ï¼š

```
ä¿¡æ ‡A: ç½®ä¿¡åº¦ 0.85 â† é€‰æ‹©è¿™ä¸ª
ä¿¡æ ‡B: ç½®ä¿¡åº¦ 0.72
ä¿¡æ ‡C: ç½®ä¿¡åº¦ 0.65
```

### Q4: ä¿¡æ ‡MACåœ°å€æ ¼å¼æœ‰è¦æ±‚å—ï¼Ÿ

**A:** æ˜¯çš„ï¼Œå¿…é¡»æ˜¯ï¼š

```
âœ… æ­£ç¡®: 68:E4:78:12:34:56 (å¤§å†™ï¼Œå†’å·åˆ†éš”)
âŒ é”™è¯¯: 68-e4-78-12-34-56
âŒ é”™è¯¯: 68e478123456
```

### Q5: å¦‚ä½•æ·»åŠ æ–°çš„æ‘„åƒå¤´åŒºåŸŸï¼Ÿ

**æ­¥éª¤ï¼š**

1. ç¼–è¾‘ `beacon_whitelist.yaml`ï¼š

```yaml
cameras:
  camera_03:  # æ–°å¢
    name: "è¥¿åŒºå‡ºå£"
    coverage_radius: 40
    rssi_threshold: -72
    beacons:
      - mac: "68:E4:78:XX:XX:XX"
        vehicle_type: "excavator"
        active: true
```

2. å¯åŠ¨ç³»ç»Ÿæ—¶æŒ‡å®šæ‘„åƒå¤´IDï¼š

```bash
python3 test_system_realtime.py --camera-id camera_03
```

### Q6: å¦‚ä½•ä¸´æ—¶åœç”¨æŸä¸ªä¿¡æ ‡ï¼Ÿ

**æ–¹æ³•1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**

```yaml
- mac: "68:E4:78:12:34:56"
  vehicle_type: "excavator"
  active: false  # æ”¹ä¸º false
```

**æ–¹æ³•2ï¼šé€šè¿‡API**

```bash
curl -X POST https://your-api.com/api/beacon/activate \
  -H "Content-Type: application/json" \
  -d '{"mac": "68:E4:78:12:34:56", "active": false}'
```

---

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘

å¦‚æœéœ€è¦æ›´å¤æ‚çš„è¿‡æ»¤é€»è¾‘ï¼Œå¯ä»¥ä¿®æ”¹ `python_apps/beacon_filter.py`ï¼š

```python
def _calculate_confidence(self, beacons, camera_depth):
    """è‡ªå®šä¹‰ç½®ä¿¡åº¦è®¡ç®—"""
    for beacon in beacons:
        score = 0.0
        
        # æ·»åŠ è‡ªå®šä¹‰é€»è¾‘
        # ä¾‹å¦‚ï¼šä¼˜å…ˆåŒ¹é…ç‰¹å®šå…¬å¸çš„è½¦è¾†
        if beacon.get('company') == 'ä¼˜å…ˆå…¬å¸':
            score += 0.1
        
        # ä¾‹å¦‚ï¼šæ ¹æ®è½¦è¾†ç±»å‹è°ƒæ•´æƒé‡
        if beacon.get('vehicle_type') == 'excavator':
            rssi_weight = 0.4  # æŒ–æ˜æœºæ›´ä¾èµ–RSSI
        else:
            rssi_weight = 0.3
        
        # ... å…¶ä»–é€»è¾‘
        
        beacon['confidence'] = score
    
    return beacons
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘ç™½åå•å¤§å°**ï¼šæ¯ä¸ªæ‘„åƒå¤´åªç»´æŠ¤å¿…è¦çš„ä¿¡æ ‡
2. **è°ƒæ•´æ—¶é—´çª—å£**ï¼šæ ¹æ®è½¦è¾†ç§»åŠ¨é€Ÿåº¦è°ƒæ•´
3. **å®šæœŸæ¸…ç†å†å²**ï¼šé¿å…å†…å­˜å ç”¨è¿‡å¤§

```yaml
time_window:
  min_duration: 2.0  # å¿«é€Ÿç§»åŠ¨åœºæ™¯
  history_size: 50   # å‡å°‘å†å²è®°å½•
```

---

## æ€»ç»“

### å…³é”®ä¼˜åŠ¿

âœ… **ç™½åå•æœºåˆ¶** - åªå¤„ç†å·²æ³¨å†Œä¿¡æ ‡ï¼Œè¿‡æ»¤æ— å…³è®¾å¤‡  
âœ… **å¤šçº§è¿‡æ»¤** - RSSIã€è·ç¦»ã€æ—¶é—´å¤šé‡éªŒè¯  
âœ… **ç½®ä¿¡åº¦è¯„åˆ†** - æ™ºèƒ½é€‰æ‹©æœ€ä½³åŒ¹é…  
âœ… **çµæ´»é…ç½®** - YAMLé…ç½®ï¼Œæ˜“äºè°ƒæ•´  
âœ… **å°ç¨‹åºé›†æˆ** - æ–¹ä¾¿ç°åœºç®¡ç†  

### æ¨èé…ç½®

```yaml
# æ¨èçš„ç”Ÿäº§ç¯å¢ƒé…ç½®
global_config:
  rssi_thresholds:
    default: -70        # ä¸­ç­‰è·ç¦»
  distance_match:
    tolerance: 3.0      # 3ç±³å®¹å·®
    depth_priority: true
  time_window:
    min_duration: 3.0   # 3ç§’æŒç»­
    history_size: 100
  confidence_threshold: 0.6  # 60%ç½®ä¿¡åº¦
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æ›´æ–°æ—¥æœŸï¼š** 2025-11-04  
**ç»´æŠ¤äººå‘˜ï¼š** LiuBo


