# 云端服务器联调快速指南

## 第一步：配置服务器信息

编辑 `config.yaml`，更新云端配置：

```yaml
cloud:
  enabled: true                              # 启用云端上传
  api_base_url: "http://your-server-ip:8000" # ⚠️ 替换为实际服务器地址
  api_key: "your-api-key-here"                # ⚠️ 替换为实际API密钥
```

## 第二步：运行联调测试

```bash
cd /home/liubo/Download/deepstream-vehicle-detection
python3 scripts/test_cloud_connection.py
```

## 测试内容

测试脚本会自动执行以下测试：

1. ✅ **健康检查** - 验证服务器连通性
2. ✅ **发送警报** - 测试警报上传功能
3. ✅ **上传图片** - 测试图片上传功能
4. ✅ **集成模块** - 测试完整集成流程

## 预期输出

```
======================================================================
云端服务器联调测试
======================================================================

配置信息:
  服务器地址: http://your-server-ip:8000
  API密钥: your-api-...
  上传图片: 是
  上传警报: 是

======================================================================
【测试1】健康检查
======================================================================
✅ 健康检查成功：服务器可达

======================================================================
【测试2】发送警报
======================================================================
✅ 警报发送成功，ID: 123

======================================================================
【测试3】上传图片
======================================================================
✅ 图片上传成功: /path/to/image.jpg

======================================================================
【测试4】集成模块测试
======================================================================
✓ 集成模块启动成功
✓ 检测结果已提交到队列
✓ 当前队列大小: 0
✓ 集成模块停止成功

======================================================================
测试结果汇总
======================================================================
  健康检查: ✅ 通过
  发送警报: ✅ 通过
  上传图片: ✅ 通过
  集成模块: ✅ 通过

✅ 所有测试通过！
```

## 常见问题

### 问题1：连接失败

**错误**：`健康检查失败：服务器不可达或返回错误`

**解决**：
1. 检查服务器地址是否正确
2. 检查网络连接：`ping your-server-ip`
3. 检查端口是否开放：`telnet your-server-ip 8000`

### 问题2：API密钥错误

**错误**：`401 Unauthorized`

**解决**：
1. 检查 `config.yaml` 中的 `api_key` 是否正确
2. 确认API密钥格式（无空格、换行）

### 问题3：导入错误

**错误**：`导入失败: No module named 'config'`

**解决**：
```bash
# 确保在项目根目录运行
cd /home/liubo/Download/deepstream-vehicle-detection

# 检查 jetson-client 模块
python3 -c "from jetson_client import SentinelIntegration; print('OK')"
```

## 联调成功后

1. ✅ 确认所有测试通过
2. ✅ 在主程序中启用云端上传（`cloud.enabled = true`）
3. ✅ 运行主程序进行实际测试
4. ✅ 监控上传队列和错误日志

## 详细文档

更多信息请参考：
- `docs/CLOUD_DEBUGGING_GUIDE.md` - 详细调试指南
- `docs/CLOUD_INTEGRATION_SUMMARY.md` - 集成说明




