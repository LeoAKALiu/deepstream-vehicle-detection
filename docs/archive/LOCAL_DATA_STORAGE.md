# é¡¹ç›®æœ¬åœ°æ•°æ®å­˜å‚¨è·¯å¾„æ¸…å•

## ğŸ“Š æ•°æ®å­˜å‚¨è·¯å¾„æ±‡æ€»

æœ¬æ–‡æ¡£åˆ—å‡ºäº†é¡¹ç›®ä¸­æ‰€æœ‰æœ¬åœ°æ•°æ®å­˜å‚¨çš„ä½ç½®å’Œç”¨é€”ã€‚

---

## 1. æ•°æ®åº“æ–‡ä»¶

### æ£€æµ‹ç»“æœæ•°æ®åº“
- **è·¯å¾„**: `detection_results.db` (é¡¹ç›®æ ¹ç›®å½•)
- **ç±»å‹**: SQLite æ•°æ®åº“
- **å†…å®¹**: 
  - æ£€æµ‹æ—¶é—´æˆ³
  - è·Ÿè¸ªID (track_id)
  - è½¦è¾†ç±»å‹ (vehicle_type)
  - æ£€æµ‹ç±»åˆ« (detected_class)
  - çŠ¶æ€ (status)
  - ä¿¡æ ‡MACåœ°å€ (beacon_mac)
  - è½¦ç‰Œå· (plate_number)
  - æ‰€å±å…¬å¸ (company)
  - è·ç¦»ã€ç½®ä¿¡åº¦ã€è¾¹ç•Œæ¡†åæ ‡
  - å¿«ç…§è·¯å¾„ (snapshot_path)
  - å…ƒæ•°æ® (metadata: JSONæ ¼å¼)
- **é…ç½®**: `config.yaml` â†’ `paths.detection_db_path`
- **æŸ¥çœ‹æ–¹æ³•**:
  ```bash
  sqlite3 detection_results.db "SELECT COUNT(*) FROM detections;"
  sqlite3 detection_results.db "SELECT * FROM detections ORDER BY timestamp DESC LIMIT 10;"
  ```

---

## 2. æ—¥å¿—æ–‡ä»¶

### ä¸»åº”ç”¨æ—¥å¿—
- **è·¯å¾„**: `/tmp/vehicle_detection.log`
- **é…ç½®**: `config.yaml` â†’ `paths.log_file`
- **å†…å®¹**: ç³»ç»Ÿè¿è¡Œæ—¥å¿—ã€æ£€æµ‹äº‹ä»¶ã€é”™è¯¯ä¿¡æ¯ã€æ€§èƒ½æŒ‡æ ‡
- **è½®è½¬**: è‡ªåŠ¨è½®è½¬ï¼Œä¿ç•™5ä¸ªå¤‡ä»½ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§10MB

### å‘Šè­¦æ—¥å¿—
- **è·¯å¾„**: `/tmp/vehicle_alerts.json`
- **é…ç½®**: `config.yaml` â†’ `paths.alert_log_file`
- **å†…å®¹**: JSONæ ¼å¼çš„å‘Šè­¦è®°å½•
- **æŸ¥çœ‹æ–¹æ³•**:
  ```bash
  cat /tmp/vehicle_alerts.json | jq .
  ```

### å¯åŠ¨æ—¥å¿—
- **è·¯å¾„**: `logs/startup.log`
- **å†…å®¹**: ç³»ç»Ÿå¯åŠ¨å’Œåˆå§‹åŒ–ä¿¡æ¯

### çœ‹é—¨ç‹—æ—¥å¿—
- **è·¯å¾„**: `logs/watchdog.log`
- **å†…å®¹**: çœ‹é—¨ç‹—ç›‘æ§äº‹ä»¶

### èµ„æºç›‘æ§æ—¥å¿—
- **è·¯å¾„**: `logs/resource_monitor.log`
- **å†…å®¹**: CPUã€å†…å­˜ã€GPUã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

### æ¸…ç†æ—¥å¿—
- **è·¯å¾„**: `logs/cleanup.log`
- **å†…å®¹**: æ•°æ®æ¸…ç†æ“ä½œè®°å½•

### å¯åŠ¨è¾“å‡ºæ—¥å¿—
- **è·¯å¾„**: `/tmp/vehicle_detection_startup.log`
- **å†…å®¹**: nohupå¯åŠ¨æ—¶çš„æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡º

### SystemdæœåŠ¡æ—¥å¿—
- **æŸ¥çœ‹å‘½ä»¤**: `sudo journalctl -u vehicle-detection`
- **å†…å®¹**: ç³»ç»Ÿçº§æœåŠ¡æ—¥å¿—

---

## 3. å¿«ç…§å›¾ç‰‡

### è½¦è¾†å¿«ç…§ç›®å½•
- **è·¯å¾„**: `/tmp/vehicle_snapshots/`
- **é…ç½®**: `config.yaml` â†’ `paths.snapshot_dir`
- **æ–‡ä»¶æ ¼å¼**: JPG
- **å‘½åè§„åˆ™**: `snapshot_{track_id}_{timestamp}.jpg`
- **å†…å®¹**: æ£€æµ‹åˆ°çš„è½¦è¾†å›¾ç‰‡ï¼ˆè£å‰ªåï¼ŒåŒ…å«è¾¹ç•Œæ¡†æ‰©å±•åŒºåŸŸï¼‰
- **é…ç½®å¼€å…³**: 
  - `config.yaml` â†’ `cloud.save_snapshots: true` (æ˜¯å¦ä¿å­˜æœ¬åœ°å¿«ç…§)
  - `config.yaml` â†’ `cloud.enable_image_upload: true` (æ˜¯å¦ä¸Šä¼ åˆ°äº‘ç«¯)
- **æœ€å¤§å¤§å°**: 5MB (ä¸Šä¼ å‰è‡ªåŠ¨å‹ç¼©)
- **æŸ¥çœ‹æ–¹æ³•**:
  ```bash
  ls -lh /tmp/vehicle_snapshots/
  find /tmp/vehicle_snapshots -name "*.jpg" | wc -l
  ```

---

## 4. æ€§èƒ½æŠ¥å‘Šæ–‡ä»¶

### æŠ¥å‘Šç›®å½•
- **è·¯å¾„**: `reports/`
- **æ–‡ä»¶æ ¼å¼**: JSON
- **å‘½åè§„åˆ™**:
  - æ—¥æŠ¥: `daily_report_YYYYMMDD.json`
  - å‘¨æŠ¥: `weekly_report_YYYYMMDD.json`
  - æœˆæŠ¥: `monthly_report_YYYYMM.json`
- **å†…å®¹**: 
  - æ€»æ£€æµ‹æ•°ã€æ€»è½¦è¾†æ•°
  - å·²å¤‡æ¡ˆ/æœªå¤‡æ¡ˆè½¦è¾†ç»Ÿè®¡
  - è½¦è¾†ç±»å‹åˆ†å¸ƒ
  - æ—¶é—´åˆ†å¸ƒï¼ˆæŒ‰å°æ—¶ï¼‰
  - æ£€æµ‹ç‡ï¼ˆæ¬¡/å°æ—¶ï¼‰
  - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
- **ç”Ÿæˆæ–¹æ³•**:
  ```bash
  python3 scripts/generate_daily_report.py
  ```

---

## 5. ä¸´æ—¶æ–‡ä»¶

### å…±äº«RGBå¸§
- **è·¯å¾„**: `/tmp/orbbec_shared_frame.npy`
- **é…ç½®**: `config.yaml` â†’ `paths.shared_frame_file`
- **å†…å®¹**: å½“å‰å¸§çš„RGBæ•°æ®ï¼ˆNumPyæ•°ç»„ï¼‰
- **ç‰¹ç‚¹**: å®æ—¶æ›´æ–°ï¼Œç¨‹åºé€€å‡ºååˆ é™¤

### å…±äº«æ·±åº¦å¸§
- **è·¯å¾„**: `/tmp/orbbec_shared_depth.npy`
- **é…ç½®**: `config.yaml` â†’ `paths.shared_depth_file`
- **å†…å®¹**: å½“å‰å¸§çš„æ·±åº¦æ•°æ®ï¼ˆNumPyæ•°ç»„ï¼‰
- **ç‰¹ç‚¹**: å®æ—¶æ›´æ–°ï¼Œç¨‹åºé€€å‡ºååˆ é™¤

---

## 6. é…ç½®æ–‡ä»¶

### ä¸»é…ç½®æ–‡ä»¶
- **è·¯å¾„**: `config.yaml` (é¡¹ç›®æ ¹ç›®å½•)
- **å†…å®¹**: ç³»ç»Ÿæ‰€æœ‰é…ç½®å‚æ•°

### ä¿¡æ ‡ç™½åå•
- **è·¯å¾„**: `beacon_whitelist.yaml` (é¡¹ç›®æ ¹ç›®å½•)
- **é…ç½®**: `config.yaml` â†’ `paths.beacon_whitelist`
- **å†…å®¹**: å·²å¤‡æ¡ˆè½¦è¾†çš„ä¿¡æ ‡MACåœ°å€å’Œè½¦è¾†ä¿¡æ¯

---

## 7. å…¶ä»–æ•°æ®æ–‡ä»¶

### 4Gæµé‡ä¼°ç®—
- **è·¯å¾„**: `4g_traffic_estimate.json` (é¡¹ç›®æ ¹ç›®å½•)
- **å†…å®¹**: 4Gæ•°æ®æµé‡ä¼°ç®—ç»“æœ

### å½•åˆ¶æ–‡ä»¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- **è·¯å¾„**: `recordings/` (ç›®å½•)
- **å†…å®¹**: å½•åˆ¶çš„è§†é¢‘å’Œå…ƒæ•°æ®æ–‡ä»¶

### å¤‡ä»½ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- **è·¯å¾„**: `backups/` (ç›®å½•)
- **å†…å®¹**: æ•°æ®åº“ã€æŠ¥å‘Šã€æ—¥å¿—çš„å¤‡ä»½æ–‡ä»¶

---

## ğŸ“ å®Œæ•´è·¯å¾„åˆ—è¡¨

| æ•°æ®ç±»å‹ | è·¯å¾„ | å¤§å°ä¼°ç®— | ä¿ç•™ç­–ç•¥ |
|---------|------|---------|---------|
| æ£€æµ‹æ•°æ®åº“ | `detection_results.db` | ~1KB/æ¡è®°å½• | æ°¸ä¹…ä¿ç•™ï¼ˆå»ºè®®å¤‡ä»½ï¼‰ |
| åº”ç”¨æ—¥å¿— | `/tmp/vehicle_detection.log` | ~10MB/æ–‡ä»¶ | 30å¤©ï¼Œè‡ªåŠ¨è½®è½¬ |
| å‘Šè­¦æ—¥å¿— | `/tmp/vehicle_alerts.json` | ~1KB/æ¡å‘Šè­¦ | 30å¤© |
| è½¦è¾†å¿«ç…§ | `/tmp/vehicle_snapshots/*.jpg` | ~100KB/å¼  | 7å¤©ï¼Œå¯é…ç½® |
| æ€§èƒ½æŠ¥å‘Š | `reports/*.json` | ~10KB/ä»½ | æ°¸ä¹…ä¿ç•™ |
| ç›‘æ§æ—¥å¿— | `logs/*.log` | ~1MB/æ–‡ä»¶ | 30å¤©ï¼Œè‡ªåŠ¨è½®è½¬ |
| ä¸´æ—¶æ–‡ä»¶ | `/tmp/orbbec_shared_*.npy` | ~10MB | ç¨‹åºè¿è¡Œæ—¶ |
| å¯åŠ¨æ—¥å¿— | `/tmp/vehicle_detection_startup.log` | ~1MB | ç¨‹åºè¿è¡Œæ—¶ |

---

## ğŸ’¾ æ•°æ®å¤§å°ä¼°ç®—

### å•æ—¥æ•°æ®é‡ï¼ˆå‡è®¾ï¼‰
- **æ£€æµ‹è®°å½•**: 100æ¡ â†’ ~100KB
- **æ—¥å¿—æ–‡ä»¶**: ~10MB
- **å¿«ç…§å›¾ç‰‡**: 50å¼  â†’ ~5MB
- **æŠ¥å‘Šæ–‡ä»¶**: ~10KB
- **æ€»è®¡**: ~15MB/å¤©

### æœˆåº¦æ•°æ®é‡
- **æ£€æµ‹è®°å½•**: 3000æ¡ â†’ ~3MB
- **æ—¥å¿—æ–‡ä»¶**: ~300MBï¼ˆè½®è½¬åï¼‰
- **å¿«ç…§å›¾ç‰‡**: 1500å¼  â†’ ~150MBï¼ˆ7å¤©ä¿ç•™ï¼‰
- **æŠ¥å‘Šæ–‡ä»¶**: ~300KB
- **æ€»è®¡**: ~450MB/æœˆ

---

## ğŸ”§ æ•°æ®ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
```bash
# æŸ¥çœ‹æ•°æ®åº“è®°å½•æ•°
sqlite3 detection_results.db "SELECT COUNT(*) FROM detections;"

# æŸ¥çœ‹å¿«ç…§æ•°é‡
find /tmp/vehicle_snapshots -name "*.jpg" | wc -l

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
du -sh detection_results.db /tmp/vehicle_snapshots reports/ logs/
```

### æŸ¥çœ‹å„è·¯å¾„å®é™…å¤§å°
```bash
cd /home/liubo/Download/deepstream-vehicle-detection

# æ•°æ®åº“
ls -lh detection_results.db 2>/dev/null || echo "ä¸å­˜åœ¨"

# æ—¥å¿—æ–‡ä»¶
ls -lh /tmp/vehicle_detection.log /tmp/vehicle_alerts.json 2>/dev/null | awk '{print $9, $5}' || echo "ä¸å­˜åœ¨"

# å¿«ç…§ç›®å½•
du -sh /tmp/vehicle_snapshots 2>/dev/null || echo "ç›®å½•ä¸å­˜åœ¨"

# æŠ¥å‘Šç›®å½•
ls -lh reports/*.json 2>/dev/null | wc -l | awk '{print "æŠ¥å‘Šæ•°é‡: "$1}' || echo "æ— æŠ¥å‘Š"

# æ—¥å¿—ç›®å½•
du -sh logs/ 2>/dev/null || echo "ç›®å½•ä¸å­˜åœ¨"
```

### æ¸…ç†æ—§æ•°æ®
```bash
# è¿è¡Œæ¸…ç†è„šæœ¬
bash scripts/cleanup_old_data.sh

# æ‰‹åŠ¨æ¸…ç†å¿«ç…§ï¼ˆä¿ç•™7å¤©ï¼‰
find /tmp/vehicle_snapshots -name "*.jpg" -mtime +7 -delete
```

### å¤‡ä»½æ•°æ®
```bash
# å¤‡ä»½æ•°æ®åº“
cp detection_results.db backups/detection_results_$(date +%Y%m%d).db

# å¤‡ä»½æŠ¥å‘Š
tar -czf backups/reports_$(date +%Y%m%d).tar.gz reports/

# å¤‡ä»½æ—¥å¿—
tar -czf backups/logs_$(date +%Y%m%d).tar.gz logs/
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **/tmpç›®å½•æ¸…ç†**
   - `/tmp` ç›®å½•å¯èƒ½åœ¨ç³»ç»Ÿé‡å¯åæ¸…ç©º
   - é‡è¦æ•°æ®å»ºè®®ä¿å­˜åˆ°é¡¹ç›®ç›®å½•

2. **ç£ç›˜ç©ºé—´ç›‘æ§**
   - å®šæœŸæ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
   - ä½¿ç”¨ `cleanup_old_data.sh` è‡ªåŠ¨æ¸…ç†

3. **æ•°æ®å¤‡ä»½**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
   - é‡è¦å¿«ç…§å»ºè®®å•ç‹¬ä¿å­˜

4. **äº‘ç«¯ä¸Šä¼ **
   - å¿«ç…§å’Œå‘Šè­¦ä¼šä¸Šä¼ åˆ°äº‘ç«¯
   - æœ¬åœ°ä¿ç•™å–å†³äº `cloud.save_snapshots` é…ç½®

---

## ğŸ“ é¡¹ç›®æ ¹ç›®å½•

æ‰€æœ‰ç›¸å¯¹è·¯å¾„å‡ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼š
```
/home/liubo/Download/deepstream-vehicle-detection/
```

