# DeepStreamè½¦è¾†æ£€æµ‹ç³»ç»Ÿ

åŸºäºNVIDIA DeepStream SDKçš„å·¥ç¨‹æœºæ¢°å®æ—¶è¯†åˆ«ç³»ç»Ÿï¼Œä½¿ç”¨YOLOv11è¿›è¡ŒGPUåŠ é€Ÿæ£€æµ‹ã€‚

---

## ğŸ“‹ é¡¹ç›®çŠ¶æ€

### âœ… å·²å®Œæˆ

- [x] é¡¹ç›®ç»“æ„åˆ›å»º
- [x] TensorRTå¼•æ“ç”Ÿæˆï¼ˆ54MB FP16ï¼‰
- [x] é…ç½®æ–‡ä»¶å‡†å¤‡
- [x] Pythonåº”ç”¨æ¡†æ¶å¼€å‘
- [x] GStreamer Pipelineè®¾è®¡
- [x] è½¦è¾†åˆ†ç±»å’Œè®¡æ•°é€»è¾‘
- [x] ç»Ÿè®¡è¾“å‡ºæ¨¡å—

### ğŸ”§ å¼€å‘ä¸­

- [ ] DeepStreamåº”ç”¨æµ‹è¯•å’Œè°ƒè¯•
- [ ] YOLOè¾“å‡ºè§£æå™¨é€‚é…
- [ ] NvDCFè·Ÿè¸ªå™¨å‚æ•°è°ƒä¼˜
- [ ] HyperLPRè½¦ç‰Œè¯†åˆ«é›†æˆ

### ğŸ“Š é¢„æœŸæ€§èƒ½

| æŒ‡æ ‡ | CPUæ–¹æ¡ˆï¼ˆå½“å‰ï¼‰ | DeepStreamæ–¹æ¡ˆï¼ˆç›®æ ‡ï¼‰ |
|------|----------------|---------------------|
| å®æ—¶æ£€æµ‹ | 25-35 FPS | 50-100 FPS |
| è§†é¢‘åˆ†æ | 0.4 FPS | 50-100 FPS |
| GPUä½¿ç”¨ | 0% | 80-95% |

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
deepstream-vehicle-detection/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ yolov11.engine              # TensorRTå¼•æ“ (54MB FP16)
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config_infer_yolov11.txt    # nvinferé…ç½®
â”‚   â”œâ”€â”€ config_tracker.txt          # nvtrackeråŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ config_tracker_NvDCF_accuracy.yml  # NvDCFè·Ÿè¸ªå™¨é…ç½®
â”‚   â””â”€â”€ labels.txt                  # ç±»åˆ«æ ‡ç­¾ï¼ˆ10ç±»è½¦è¾†ï¼‰
â”œâ”€â”€ python_apps/
â”‚   â””â”€â”€ deepstream_vehicle_detection.py  # ä¸»åº”ç”¨ï¼ˆ412è¡Œï¼‰
â”œâ”€â”€ æµ‹è¯•DeepStreamåº”ç”¨.sh           # ä¸€é”®æµ‹è¯•è„šæœ¬
â”œâ”€â”€ éªŒè¯é…ç½®.sh                     # é…ç½®éªŒè¯è„šæœ¬
â”œâ”€â”€ å¼€å‘æŒ‡å—.md                     # è¯¦ç»†å¼€å‘æ–‡æ¡£
â””â”€â”€ README.md                       # æœ¬æ–‡ä»¶
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä¸€é”®æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
cd /home/liubo/Download/deepstream-vehicle-detection
bash æµ‹è¯•DeepStreamåº”ç”¨.sh
```

### æ–¹å¼2ï¼šæ‰‹åŠ¨è¿è¡Œ

```bash
# 1. è¿›å…¥DeepStreamå®¹å™¨
sudo docker run -it --rm --runtime nvidia --network host \
    -v /home/liubo/Download:/workspace \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -e DISPLAY=$DISPLAY \
    -w /workspace/deepstream-vehicle-detection \
    nvcr.io/nvidia/deepstream:7.0-triton-multiarch \
    bash

# 2. åœ¨å®¹å™¨å†…è¿è¡Œ
python3 python_apps/deepstream_vehicle_detection.py /workspace/20211216-101333.mp4
```

---

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### ç¡¬ä»¶

- **å¹³å°**: NVIDIA Jetson Orin
- **GPU**: 8 SMs, 7.6GBå†…å­˜
- **æ¶æ„**: ARM64 (aarch64)

### è½¯ä»¶

- **DeepStream**: 7.0 (Docker)
- **TensorRT**: 8.6.2
- **GStreamer**: 1.0
- **CUDA**: 12.2
- **Python**: 3.10

### ä¾èµ–å®¹å™¨

```bash
nvcr.io/nvidia/deepstream:7.0-triton-multiarch
```

---

## ğŸ“¦ æ¨¡å‹ä¿¡æ¯

### YOLOv11n è½¦è¾†æ£€æµ‹æ¨¡å‹

- **è¾“å…¥**: `[1, 3, 640, 640]` RGB
- **è¾“å‡º**: `[1, 14, 8400]` 
  - 14é€šé“: [x, y, w, h, conf, class0...class9]
  - 8400å€™é€‰æ¡†: 3ä¸ªå°ºåº¦ç‰¹å¾å›¾
- **ç±»åˆ«**: 10ç±»è½¦è¾†
  - å·¥ç¨‹è½¦è¾†ï¼ˆ8ç±»ï¼‰ï¼šæŒ–æ˜æœºã€æ¨åœŸæœºã€å‹è·¯æœºã€è£…è½½æœºã€è‡ªå¸è½¦ã€æ…æ‹Œè½¦ã€æ³µè½¦ã€èµ·é‡æœº
  - ç¤¾ä¼šè½¦è¾†ï¼ˆ2ç±»ï¼‰ï¼šå¡è½¦ã€è½¿è½¦

### TensorRTå¼•æ“

- **æ–‡ä»¶**: `models/yolov11.engine`
- **å¤§å°**: 54MB
- **ç²¾åº¦**: FP16
- **æ„å»ºæ—¶é—´**: 15åˆ†é’Ÿ
- **æ¥æº**: `best.onnx` (97MB)

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. GPUåŠ é€Ÿæ£€æµ‹

- TensorRTä¼˜åŒ–æ¨ç†
- FP16ç²¾åº¦
- æ‰¹å¤„ç†æ”¯æŒ
- å¤šæµå¹¶è¡Œ

### 2. ç›®æ ‡è·Ÿè¸ª

- NvDCFè·Ÿè¸ªå™¨
- å”¯ä¸€IDåˆ†é…
- é¿å…é‡å¤è®¡æ•°
- å¤„ç†é®æŒ¡å’Œç¦»å¼€/è¿›å…¥

### 3. è½¦è¾†åˆ†ç±»

- å·¥ç¨‹è½¦è¾†è‡ªåŠ¨è®¡æ•°
- æŒ‰ç±»å‹ç»Ÿè®¡
- å®æ—¶æ›´æ–°

### 4. è½¦ç‰Œè¯†åˆ«ï¼ˆè®¡åˆ’ï¼‰

- ç¤¾ä¼šè½¦è¾†è½¦ç‰Œè¯†åˆ«
- HyperLPR3é›†æˆ
- ROIè£å‰ªå’Œè¯†åˆ«

### 5. ç»Ÿè®¡è¾“å‡º

- å®æ—¶ç»Ÿè®¡æ˜¾ç¤º
- æŒ‰è½¦å‹åˆ†ç±»è®¡æ•°
- è½¦ç‰Œåˆ—è¡¨
- æ€§èƒ½æŒ‡æ ‡

---

## ğŸ”¬ æŠ€æœ¯æ¶æ„

### GStreamer Pipeline

```
è§†é¢‘æº (filesrc/v4l2src)
  â†“
H264è§£æ (h264parse)
  â†“
ç¡¬ä»¶è§£ç  (nvv4l2decoder)
  â†“
æµå¤ç”¨ (nvstreammux)
  â†“
æ¨ç†å¼•æ“ (nvinfer) â† TensorRTå¼•æ“
  â†“
ç›®æ ‡è·Ÿè¸ª (nvtracker) â† NvDCF
  â†“
è§†é¢‘è½¬æ¢ (nvvideoconvert)
  â†“
OSDæ˜¾ç¤º (nvdsosd)
  â†“
è¾“å‡º (filesink/nveglglessink)
```

### Pythonåº”ç”¨æ¶æ„

```python
VehicleDetectionApp
â”œâ”€â”€ build_pipeline()          # æ„å»ºGStreamer pipeline
â”œâ”€â”€ osd_sink_pad_buffer_probe()  # å¤„ç†æ£€æµ‹ç»“æœ
â”‚   â”œâ”€â”€ è®¿é—®batch metadata
â”‚   â”œâ”€â”€ éå†æ£€æµ‹å¯¹è±¡
â”‚   â”œâ”€â”€ è·Ÿè¸ªIDç®¡ç†
â”‚   â”œâ”€â”€ è½¦è¾†åˆ†ç±»è®¡æ•°
â”‚   â””â”€â”€ è½¦ç‰Œè¯†åˆ«ï¼ˆè®¡åˆ’ï¼‰
â”œâ”€â”€ bus_call()                # å¤„ç†GStreameræ¶ˆæ¯
â”œâ”€â”€ run()                     # ä¸»å¾ªç¯
â””â”€â”€ print_statistics()        # ç»Ÿè®¡è¾“å‡º
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. YOLOè¾“å‡ºè§£æ

**é—®é¢˜**: YOLOv11è¾“å‡ºæ ¼å¼`[1, 14, 8400]`éœ€è¦è‡ªå®šä¹‰è§£æå™¨

**è§£å†³æ–¹æ¡ˆ**:
- å°è¯•DeepStreamå†…ç½®`NvDsInferParseYolo`
- æˆ–ç¼–å†™è‡ªå®šä¹‰C++è§£æå™¨
- æˆ–Pythonåå¤„ç†

### 2. pyds Pythonç»‘å®š

**é—®é¢˜**: å¯èƒ½éœ€è¦åœ¨å®¹å™¨å†…é¢å¤–å®‰è£…

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd /opt/nvidia/deepstream/deepstream/sources/deepstream_python_apps/bindings/
pip3 install ./
```

### 3. é…ç½®æ–‡ä»¶è·¯å¾„

**é—®é¢˜**: ç›¸å¯¹è·¯å¾„å¯èƒ½å¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç¡®ä¿å·¥ä½œç›®å½•æ­£ç¡®

---

## ğŸ“š æ–‡æ¡£

- **å¼€å‘æŒ‡å—**: `å¼€å‘æŒ‡å—.md` - è¯¦ç»†çš„å¼€å‘å’Œè°ƒè¯•æŒ‡å—
- **ä»Šæ—¥æˆæœ**: `ä»Šæ—¥æˆæœä¸æ˜æ—¥è®¡åˆ’.md` - å¼€å‘è¿›åº¦å’Œè®¡åˆ’
- **é…ç½®éªŒè¯**: `bash éªŒè¯é…ç½®.sh` - éªŒè¯ç¯å¢ƒé…ç½®

---

## ğŸ” è°ƒè¯•æŠ€å·§

### å¯ç”¨è¯¦ç»†æ—¥å¿—

```bash
export GST_DEBUG=3
export NVDS_LOG_LEVEL=5
python3 python_apps/deepstream_vehicle_detection.py video.mp4
```

### æµ‹è¯•TensorRTå¼•æ“

```bash
/usr/src/tensorrt/bin/trtexec \
    --loadEngine=models/yolov11.engine \
    --verbose
```

### æŸ¥çœ‹DeepStreamç¤ºä¾‹

```bash
ls /opt/nvidia/deepstream/deepstream/sources/deepstream_python_apps/apps/
```

---

## ğŸ“Š æ€§èƒ½ç›®æ ‡

### å•æµæ€§èƒ½

| åˆ†è¾¨ç‡ | ç›®æ ‡FPS | GPUä½¿ç”¨ | å†…å­˜å ç”¨ |
|--------|---------|---------|----------|
| 1920x1080 | 50-100 | 80-95% | ~2GB |
| 1280x720 | 100-150 | 70-85% | ~1.5GB |

### å¤šæµæ€§èƒ½

| æµæ•° | åˆ†è¾¨ç‡ | FPS/æµ | GPUä½¿ç”¨ |
|------|--------|--------|---------|
| 1 | 1920x1080 | 50-100 | 80% |
| 2 | 1280x720 | 50-80 | 95% |
| 4 | 640x480 | 30-50 | 95% |

---

## ğŸ› ï¸ å¼€å‘è·¯çº¿å›¾

### å½“å‰é˜¶æ®µï¼ˆDay 2ï¼‰

- [ ] æµ‹è¯•åŸºç¡€pipelineè¿è¡Œ
- [ ] éªŒè¯æ£€æµ‹è¾“å‡º
- [ ] è°ƒè¯•YOLOè§£æå™¨
- [ ] ç¡®è®¤è·Ÿè¸ªåŠŸèƒ½

### ä¸‹ä¸€é˜¶æ®µï¼ˆDay 3ï¼‰

- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆbatch-size, åˆ†è¾¨ç‡, è·³å¸§ï¼‰
- [ ] HyperLPRé›†æˆ
- [ ] å®Œæ•´æµ‹è¯•éªŒè¯
- [ ] ç”Ÿäº§éƒ¨ç½²å‡†å¤‡

---

## ğŸ“ è·å–å¸®åŠ©

### å®˜æ–¹èµ„æº

- **DeepStreamæ–‡æ¡£**: https://docs.nvidia.com/metropolis/deepstream/
- **Pythonç¤ºä¾‹**: https://github.com/NVIDIA-AI-IOT/deepstream_python_apps
- **å¼€å‘è€…è®ºå›**: https://forums.developer.nvidia.com/c/deepstream-sdk/

### é¡¹ç›®æ–‡æ¡£

- æŸ¥çœ‹ `å¼€å‘æŒ‡å—.md` è·å–è¯¦ç»†å¼€å‘è¯´æ˜
- è¿è¡Œ `bash éªŒè¯é…ç½®.sh` æ£€æŸ¥ç¯å¢ƒ
- æŸ¥çœ‹ `ä»Šæ—¥æˆæœä¸æ˜æ—¥è®¡åˆ’.md` äº†è§£å¼€å‘è¿›åº¦

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ç”¨äºå·¥ç¨‹æœºæ¢°å®æ—¶è¯†åˆ«ç³»ç»Ÿï¼ŒåŸºäºNVIDIA DeepStream SDKã€‚

---

**æœ€åæ›´æ–°**: 2025-10-27  
**çŠ¶æ€**: å¼€å‘ä¸­ï¼ˆDay 2ï¼‰  
**ä¸‹ä¸€æ­¥**: åœ¨DeepStreamå®¹å™¨ä¸­æµ‹è¯•åº”ç”¨
