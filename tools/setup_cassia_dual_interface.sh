#!/bin/bash

cat << 'EOF'

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ”§ é…ç½®Cassiaè·¯ç”±å™¨ï¼ˆå°è¯•ä¸¤ä¸ªç½‘å£ï¼‰                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


Jetsonæœ‰ä¸¤ä¸ªæœ‰çº¿ç½‘å£ï¼š
  â€¢ enP8p1s0
  â€¢ enP1p1s0

æˆ‘ä»¬ä¼šå°è¯•ä¸¤ä¸ªç½‘å£ï¼Œæ‰¾åˆ°è¿æ¥è·¯ç”±å™¨çš„é‚£ä¸ª

EOF

echo "ã€æ­¥éª¤1ï¼šå…ˆå°è¯• enP1p1s0ã€‘"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "å¯åŠ¨ç½‘å£..."
sudo ip link set enP1p1s0 down 2>/dev/null
sudo ip addr flush dev enP1p1s0 2>/dev/null
sudo ip link set enP1p1s0 up

echo "ç­‰å¾…2ç§’..."
sleep 2

echo "æ£€æŸ¥é“¾è·¯çŠ¶æ€..."
CARRIER1=$(cat /sys/class/net/enP1p1s0/carrier 2>/dev/null)
echo "  enP1p1s0 carrier: $CARRIER1"

if [ "$CARRIER1" = "1" ]; then
    echo "  âœ“ enP1p1s0 æœ‰é“¾è·¯è¿æ¥ï¼"
    TARGET_IFACE="enP1p1s0"
else
    echo "  âœ— enP1p1s0 æ— é“¾è·¯"
    echo ""
    echo "ã€æ­¥éª¤2ï¼šå°è¯• enP8p1s0ã€‘"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo ""
    
    echo "å¯åŠ¨ç½‘å£..."
    sudo ip link set enP8p1s0 down 2>/dev/null
    sudo ip addr flush dev enP8p1s0 2>/dev/null
    sudo ip link set enP8p1s0 up
    
    echo "ç­‰å¾…2ç§’..."
    sleep 2
    
    echo "æ£€æŸ¥é“¾è·¯çŠ¶æ€..."
    CARRIER2=$(cat /sys/class/net/enP8p1s0/carrier 2>/dev/null)
    echo "  enP8p1s0 carrier: $CARRIER2"
    
    if [ "$CARRIER2" = "1" ]; then
        echo "  âœ“ enP8p1s0 æœ‰é“¾è·¯è¿æ¥ï¼"
        TARGET_IFACE="enP8p1s0"
    else
        echo "  âœ— enP8p1s0 ä¹Ÿæ— é“¾è·¯"
        echo ""
        cat << 'FAIL'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âš ï¸ ä¸¤ä¸ªç½‘å£éƒ½æ²¡æœ‰æ£€æµ‹åˆ°é“¾è·¯                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å¯èƒ½çš„åŸå› ï¼š
1. ç½‘çº¿é—®é¢˜ï¼ˆå°è¯•æ›´æ¢ç½‘çº¿ï¼‰
2. è·¯ç”±å™¨ç«¯å£é—®é¢˜
3. éœ€è¦æ›´é•¿çš„åˆå§‹åŒ–æ—¶é—´

å»ºè®®ï¼š
â€¢ ç¡®è®¤ç½‘çº¿ä¸¤ç«¯éƒ½æ’ç´§
â€¢ ç¡®è®¤è·¯ç”±å™¨é€šç”µä¸”æ­£å¸¸å·¥ä½œ
â€¢ å°è¯•é‡å¯è·¯ç”±å™¨
â€¢ ç­‰å¾…30ç§’åé‡æ–°è¿è¡Œæ­¤è„šæœ¬

FAIL
        exit 1
    fi
fi

echo ""
echo "ã€æ­¥éª¤3ï¼šé…ç½®IPåœ°å€ã€‘"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ä½¿ç”¨ç½‘å£: $TARGET_IFACE"
echo ""

echo "é…ç½®IP: 192.168.40.2/24"
sudo ip addr add 192.168.40.2/24 dev $TARGET_IFACE 2>/dev/null

if [ $? -eq 0 ]; then
    echo "  âœ“ IPé…ç½®æˆåŠŸ"
else
    echo "  âš  IPå¯èƒ½å·²å­˜åœ¨ï¼Œç»§ç»­..."
fi

echo ""
echo "å½“å‰é…ç½®:"
ip addr show $TARGET_IFACE | grep -E "inet |state"

echo ""
echo "ã€æ­¥éª¤4ï¼šæµ‹è¯•è¿æ¥ã€‘"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ping 192.168.40.1 (3æ¬¡)..."
ping -c 3 -W 2 192.168.40.1

if [ $? -eq 0 ]; then
    echo ""
    echo "  âœ“ è¿æ¥æˆåŠŸï¼"
    echo ""
    
    echo "ã€æ­¥éª¤5ï¼šæµ‹è¯•Cassia APIã€‘"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    
    echo "HTTPæ ¹ç›®å½•:"
    curl -s -m 3 "http://192.168.40.1/" 2>&1 | head -5
    echo ""
    
    echo "APIç«¯ç‚¹:"
    curl -s -m 3 "http://192.168.40.1/api" 2>&1 | head -5
    echo ""
    
    echo "æ‰«æç«¯ç‚¹:"
    timeout 3 curl -s "http://192.168.40.1/gap/nodes?event=1" 2>&1 | head -10
    echo ""
    
    cat << SUCCESS

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âœ… Cassiaè·¯ç”±å™¨è¿æ¥æˆåŠŸï¼                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç½‘å£: $TARGET_IFACE
Jetson IP: 192.168.40.2
è·¯ç”±å™¨IP: 192.168.40.1


ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•ä¿¡æ ‡æ‰«æ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /home/liubo/Download/deepstream-vehicle-detection/python_apps
python3 cassia_local_client.py


æˆ–ç›´æ¥è¿è¡Œå®Œæ•´ç³»ç»Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /home/liubo/Download/deepstream-vehicle-detection

python3 python_apps/tensorrt_yolo_inference.py \\
    ../20211216-101333.mp4 \\
    --engine models/yolov11_host.engine \\
    --cassia-local 192.168.40.1

SUCCESS
    
else
    echo ""
    echo "  âœ— ä»ç„¶æ— æ³•pingé€š"
    echo ""
    
    cat << 'FAIL2'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âš ï¸ æœ‰é“¾è·¯ä½†æ— æ³•pingé€š                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç‰©ç†è¿æ¥æ­£å¸¸ï¼Œä½†æ— æ³•é€šä¿¡

å¯èƒ½åŸå› ï¼š
1. è·¯ç”±å™¨IPä¸æ˜¯192.168.40.1
2. è·¯ç”±å™¨é˜²ç«å¢™è®¾ç½®
3. è·¯ç”±å™¨æœªå®Œå…¨å¯åŠ¨

å°è¯•ï¼š
â€¢ è®¿é—®è·¯ç”±å™¨Webç•Œé¢ç¡®è®¤IP
â€¢ æŸ¥çœ‹è·¯ç”±å™¨è¯´æ˜ä¹¦
â€¢ å°è¯•å…¶ä»–IPåœ°å€ï¼š
  - 192.168.1.1
  - 192.168.0.1
  - 10.10.10.1

æ‰‹åŠ¨æµ‹è¯•å…¶ä»–IP:
sudo ip addr add 192.168.1.50/24 dev $TARGET_IFACE
ping 192.168.1.1

FAIL2
    exit 1
fi

