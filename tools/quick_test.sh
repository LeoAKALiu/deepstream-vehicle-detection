#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              ğŸš€ å¿«é€Ÿæµ‹è¯•Cassiaè¿æ¥                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "æ–¹æ¡ˆ1: å›ºå®šIP 192.168.40.2 â†’ 192.168.40.1"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
bash é…ç½®Cassiaç½‘ç»œ-å®Œæ•´ç‰ˆ.sh
if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… æˆåŠŸï¼è·¯ç”±å™¨åœ¨ 192.168.40.1"
    exit 0
fi

echo ""
echo "æ–¹æ¡ˆ2: å°è¯•DHCPè‡ªåŠ¨è·å–"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "æ¸…é™¤ç°æœ‰IP..."
sudo ip addr flush dev enP8p1s0
echo "è¯·æ±‚DHCP..."
sudo dhclient -v enP8p1s0 2>&1 | grep -E "DHCPOFFER|bound to" | head -3
sleep 2

NEW_IP=$(ip addr show enP8p1s0 | grep "inet " | awk '{print $2}' | cut -d/ -f1)
if [ -n "$NEW_IP" ]; then
    echo "âœ“ è·å¾—IP: $NEW_IP"
    
    # å°è¯•æ‰¾ç½‘å…³
    GATEWAY=$(ip route | grep "default.*enP8p1s0" | awk '{print $3}')
    if [ -n "$GATEWAY" ]; then
        echo "âœ“ ç½‘å…³: $GATEWAY"
        echo ""
        echo "æµ‹è¯•è¿æ¥..."
        ping -c 2 $GATEWAY
        
        if [ $? -eq 0 ]; then
            echo ""
            echo "âœ… æˆåŠŸï¼è·¯ç”±å™¨å¯èƒ½åœ¨ $GATEWAY"
            echo ""
            echo "å°è¯•è®¿é—®API:"
            curl -s -m 3 "http://$GATEWAY/api" | head -5
        fi
    fi
else
    echo "âœ— DHCPå¤±è´¥"
fi

echo ""
echo "æ–¹æ¡ˆ3: æ‰«ææŸ¥æ‰¾è·¯ç”±å™¨"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
bash æŸ¥æ‰¾Cassiaè·¯ç”±å™¨.sh

