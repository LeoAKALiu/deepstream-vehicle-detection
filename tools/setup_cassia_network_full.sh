#!/bin/bash

cat << 'EOF'

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ðŸ”§ é…ç½®Cassiaè·¯ç”±å™¨ç½‘ç»œï¼ˆå®Œæ•´ç‰ˆï¼‰                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ç½‘ç»œæž¶æž„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Jetson Orin
  â”œâ”€ wlP7p1s0 (WiFi): 192.168.1.26 â†’ äº’è”ç½‘
  â”‚    é»˜è®¤è·¯ç”±: via 192.168.1.1
  â”‚
  â””â”€ enP8p1s0 (æœ‰çº¿): 192.168.40.2 â†’ Cassiaè·¯ç”±å™¨
       ç‰¹å®šè·¯ç”±: 192.168.40.0/24 via enP8p1s0


å¼€å§‹é…ç½®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

echo "ã€1. æ£€æŸ¥ç½‘å¡çŠ¶æ€ã€‘"
echo "æœ‰çº¿ç½‘å¡ enP8p1s0:"
LINK_STATUS=$(cat /sys/class/net/enP8p1s0/operstate 2>/dev/null)
if [ "$LINK_STATUS" = "up" ]; then
    echo "  âœ“ ç½‘å¡å·²å¯åŠ¨"
else
    echo "  âš  ç½‘å¡çŠ¶æ€: $LINK_STATUSï¼Œæ­£åœ¨å¯åŠ¨..."
    sudo ip link set enP8p1s0 up
fi
echo ""

echo "ã€2. æ£€æŸ¥çŽ°æœ‰IPã€‘"
CURRENT_IP=$(ip addr show enP8p1s0 | grep "inet 192.168.40" | awk '{print $2}')
if [ -n "$CURRENT_IP" ]; then
    echo "  âœ“ å·²æœ‰IP: $CURRENT_IP"
else
    echo "  é…ç½®IPåœ°å€..."
    sudo ip addr add 192.168.40.2/24 dev enP8p1s0
    if [ $? -eq 0 ]; then
        echo "  âœ“ IPé…ç½®æˆåŠŸ: 192.168.40.2/24"
    else
        echo "  âš  IPé…ç½®å¤±è´¥ï¼ˆå¯èƒ½å·²å­˜åœ¨ï¼‰"
    fi
fi
echo ""

echo "ã€3. æ£€æŸ¥è·¯ç”±è¡¨ã€‘"
echo "å½“å‰é»˜è®¤è·¯ç”±:"
ip route show default
echo ""

# æ£€æŸ¥æ˜¯å¦å·²æœ‰åˆ°192.168.40.0çš„è·¯ç”±
ROUTE_EXISTS=$(ip route show | grep "192.168.40.0/24")
if [ -n "$ROUTE_EXISTS" ]; then
    echo "  âœ“ å·²æœ‰è·¯ç”±: $ROUTE_EXISTS"
else
    echo "  æ·»åŠ è·¯ç”±..."
    sudo ip route add 192.168.40.0/24 dev enP8p1s0 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "  âœ“ è·¯ç”±æ·»åŠ æˆåŠŸ"
    fi
fi
echo ""

echo "ã€4. éªŒè¯é…ç½®ã€‘"
ip addr show enP8p1s0
echo ""

echo "ã€5. æµ‹è¯•ç‰©ç†è¿žæŽ¥ã€‘"
echo "æ£€æŸ¥ç½‘çº¿è¿žæŽ¥çŠ¶æ€..."
if command -v ethtool &> /dev/null; then
    LINK_DETECTED=$(sudo ethtool enP8p1s0 2>/dev/null | grep "Link detected" | awk '{print $3}')
    if [ "$LINK_DETECTED" = "yes" ]; then
        echo "  âœ“ ç½‘çº¿å·²è¿žæŽ¥"
    else
        echo "  âœ— ç½‘çº¿æœªè¿žæŽ¥æˆ–è·¯ç”±å™¨æœªé€šç”µ"
        echo ""
        echo "è¯·æ£€æŸ¥:"
        echo "  1. ç½‘çº¿æ˜¯å¦æ’å¥½ï¼ˆJetson enP8p1s0å£ï¼‰"
        echo "  2. Cassiaè·¯ç”±å™¨æ˜¯å¦é€šç”µ"
        echo "  3. è·¯ç”±å™¨ç½‘å£æŒ‡ç¤ºç¯æ˜¯å¦äº®"
        exit 1
    fi
else
    echo "  âš  ethtoolæœªå®‰è£…ï¼Œè·³è¿‡ç‰©ç†è¿žæŽ¥æ£€æŸ¥"
fi
echo ""

echo "ã€6. æµ‹è¯•è¿žæŽ¥ã€‘"
echo "ping 192.168.40.1 (3æ¬¡)..."
ping -c 3 -W 2 192.168.40.1
PING_RESULT=$?
echo ""

if [ $PING_RESULT -eq 0 ]; then
    echo "  âœ“ è·¯ç”±å™¨è¿žæŽ¥æˆåŠŸï¼"
    echo ""
    
    echo "ã€7. æµ‹è¯•Cassia APIã€‘"
    echo "GET http://192.168.40.1/"
    curl -s -m 3 "http://192.168.40.1/" 2>&1 | head -5
    echo ""
    
    echo "GET http://192.168.40.1/api"
    curl -s -m 3 "http://192.168.40.1/api" 2>&1 | head -5
    echo ""
    
    cat << 'SUCCESS'

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âœ… ç½‘ç»œé…ç½®æˆåŠŸï¼                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•ä¿¡æ ‡æ‰«æ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /home/liubo/Download/deepstream-vehicle-detection/python_apps
python3 cassia_local_client.py


æˆ–ç›´æŽ¥è¿è¡Œå®Œæ•´ç³»ç»Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /home/liubo/Download/deepstream-vehicle-detection

python3 python_apps/tensorrt_yolo_inference.py \
    ../20211216-101333.mp4 \
    --engine models/yolov11_host.engine \
    --cassia-local 192.168.40.1

SUCCESS
    
else
    echo "  âœ— æ— æ³•pingé€šè·¯ç”±å™¨"
    echo ""
    
    cat << 'FAILED'

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âš ï¸ è¿žæŽ¥å¤±è´¥ - è¯Šæ–­ä¿¡æ¯                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


æ•…éšœæŽ’é™¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. æ£€æŸ¥ç‰©ç†è¿žæŽ¥
   - ç½‘çº¿æ˜¯å¦æ’å¥½
   - è·¯ç”±å™¨æ˜¯å¦é€šç”µ
   - ç½‘å£æŒ‡ç¤ºç¯æ˜¯å¦äº®

2. æ£€æŸ¥è·¯ç”±å™¨IP
   - è·¯ç”±å™¨é»˜è®¤IPå¯èƒ½ä¸æ˜¯192.168.40.1
   - å°è¯•è®¿é—®è·¯ç”±å™¨Webç•Œé¢ç¡®è®¤

3. è·¯ç”±å™¨å¯èƒ½éœ€è¦åˆå§‹åŒ–
   - æŸäº›è·¯ç”±å™¨é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½®
   - å°è¯•é€šè¿‡å…¶ä»–è®¾å¤‡è®¿é—®è·¯ç”±å™¨

4. è¿è¡Œè¯¦ç»†è¯Šæ–­
   bash è¯Šæ–­Cassiaè¿žæŽ¥.sh


è¯·æ£€æŸ¥ä¸Šè¿°é—®é¢˜åŽé‡æ–°è¿è¡Œæ­¤è„šæœ¬

FAILED
    
    exit 1
fi

